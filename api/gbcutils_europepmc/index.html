<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://globalbiodata.github.io/gbc-publication-analysis/api/gbcutils_europepmc/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>europepmc - GBC Publication Analysis API documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "europepmc";
        var mkdocs_page_input_path = "api/gbcutils_europepmc.md";
        var mkdocs_page_url = "/gbc-publication-analysis/api/gbcutils_europepmc/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> GBC Publication Analysis API documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../usage/">Usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../schema/">Database Schema</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >globalbiodata</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_resource/">Resource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_publication/">Publication</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_grant/">Grant & GrantAgency</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_url/">URL & ConnectionStatus</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_accession/">Accession</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_resource_mention/">ResourceMention & MatchedAlias</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_version/">Version</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../globalbiodata_utils/">Utilities</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >gbcutils</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../gbcutils_db/">db</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">europepmc</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#gbcutils.europepmc.epmc_search">epmc_search</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#gbcutils.europepmc.get_fulltext_body">get_fulltext_body</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#gbcutils.europepmc.query_europepmc">query_europepmc</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../gbcutils_metadata/">metadata</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../gbcutils_scibert/">scibert_classify</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">GBC Publication Analysis API documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Reference</li>
          <li class="breadcrumb-item">gbcutils</li>
      <li class="breadcrumb-item active">europepmc</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/globalbiodata/gbc-publication-analysis/edit/master/docs/api/gbcutils_europepmc.md">Edit on gbc-publication-analysis</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<h2 id="gbcutils.europepmc" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">gbcutils.europepmc</span>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="gbcutils.europepmc.epmc_search" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">epmc_search</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">epmc_search</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">query</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">result_type</span><span class="o">=</span><span class="s2">&quot;core&quot;</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">cursor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">returncursor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">fields</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">page_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Search Europe PMC with pagination support.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>query</code></b>
                  (<code><span title="str">str</span></code>)
              â€“
              <div class="doc-md-description">
                <p>The search query string.</p>
              </div>
            </li>
            <li>
              <b><code>result_type</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;core&#39;</code>
)
              â€“
              <div class="doc-md-description">
                <p>The type of results to return ('core', 'lite', 'idlist').</p>
              </div>
            </li>
            <li>
              <b><code>limit</code></b>
                  (<code><span title="int">int</span></code>, default:
                      <code>0</code>
)
              â€“
              <div class="doc-md-description">
                <p>Maximum number of results to return (0 for all - default).</p>
              </div>
            </li>
            <li>
              <b><code>cursor</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>, default:
                      <code>None</code>
)
              â€“
              <div class="doc-md-description">
                <p>Cursor mark for pagination (None for first page).</p>
              </div>
            </li>
            <li>
              <b><code>returncursor</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              â€“
              <div class="doc-md-description">
                <p>If True, return the final cursor along with results.</p>
              </div>
            </li>
            <li>
              <b><code>fields</code></b>
                  (<code><span title="list">list</span></code>, default:
                      <code>[]</code>
)
              â€“
              <div class="doc-md-description">
                <p>List of fields to include in results (empty for all).</p>
              </div>
            </li>
            <li>
              <b><code>page_size</code></b>
                  (<code><span title="int">int</span></code>, default:
                      <code>1000</code>
)
              â€“
              <div class="doc-md-description">
                <p>Number of results per page (max 1000).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Optional">Optional</span>[<span title="list">list</span>]</code>
              â€“
              <div class="doc-md-description">
                <p>List of search results, or <code>(results, cursor)</code> if <code>returncursor</code> is <code>True</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>gbcutils/europepmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="k">def</span><span class="w"> </span><span class="nf">epmc_search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">result_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;core&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">returncursor</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Search Europe PMC with pagination support.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        query (str): The search query string.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        result_type (str): The type of results to return (&#39;core&#39;, &#39;lite&#39;, &#39;idlist&#39;).</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        limit (int): Maximum number of results to return (0 for all - default).</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        cursor (Optional[str]): Cursor mark for pagination (None for first page).</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        returncursor (bool): If True, return the final cursor along with results.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        fields (list): List of fields to include in results (empty for all).</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        page_size (int): Number of results per page (max 1000).</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        List of search results, or `(results, cursor)` if `returncursor` is `True`.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">page_size</span> <span class="o">=</span> <span class="n">limit</span> <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&lt;=</span> <span class="n">page_size</span><span class="p">)</span> <span class="k">else</span> <span class="n">page_size</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">more_data</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">while</span> <span class="n">more_data</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">search_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span> <span class="s1">&#39;resultType&#39;</span><span class="p">:</span> <span class="n">result_type</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;pageSize&#39;</span><span class="p">:</span> <span class="n">page_size</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="s1">&#39;cursorMark&#39;</span><span class="p">:</span> <span class="n">cursor</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="p">}</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">query_europepmc</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">epmc_base_url</span><span class="si">}</span><span class="s2">/search&quot;</span><span class="p">,</span> <span class="n">search_params</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span> <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hitCount&#39;</span><span class="p">))</span> <span class="k">else</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hitCount&#39;</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">VERBOSE</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- Expecting </span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hitCount&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> results for query &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">restricted_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;resultList&#39;</span><span class="p">][</span><span class="s1">&#39;result&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="n">restricted_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">result</span><span class="p">})</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;resultList&#39;</span><span class="p">][</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">restricted_results</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;resultList&#39;</span><span class="p">][</span><span class="s1">&#39;result&#39;</span><span class="p">])</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nextCursorMark&#39;</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">-- got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results (cursor: </span><span class="si">{</span><span class="n">cursor</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">VERBOSE</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="n">more_data</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reached limit of </span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2"> results, stopping.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">more_data</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># reset cursor to avoid further queries</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">all_results</span><span class="p">,</span> <span class="n">cursor</span><span class="p">)</span> <span class="k">if</span> <span class="n">returncursor</span> <span class="k">else</span> <span class="n">all_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gbcutils.europepmc.get_fulltext_body" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_fulltext_body</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_fulltext_body</span><span class="p">(</span><span class="n">pmcid</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch the full text body of a publication from Europe PMC by PMCID.
If a local path is provided, it will first check for a local XML file.
If not found, it will download the XML from Europe PMC.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>pmcid</code></b>
                  (<code><span title="str">str</span></code>)
              â€“
              <div class="doc-md-description">
                <p>The PMCID of the publication (e.g., 'PMC123456').</p>
              </div>
            </li>
            <li>
              <b><code>path</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>, default:
                      <code>None</code>
)
              â€“
              <div class="doc-md-description">
                <p>Local directory path to search for XML files.</p>
              </div>
            </li>
            <li>
              <b><code>dest</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;/tmp&#39;</code>
)
              â€“
              <div class="doc-md-description">
                <p>Destination directory for downloaded/extracted XML files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="tuple">tuple</span></code>
              â€“
              <div class="doc-md-description">
                <p>(text_blocks, table_blocks) where text_blocks is a list of strings
   representing the main text sections, and table_blocks is a list of
   strings representing the tables extracted from the XML.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>gbcutils/europepmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_fulltext_body</span><span class="p">(</span><span class="n">pmcid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/tmp&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    Fetch the full text body of a publication from Europe PMC by PMCID.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    If a local path is provided, it will first check for a local XML file.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    If not found, it will download the XML from Europe PMC.</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">        pmcid (str): The PMCID of the publication (e.g., &#39;PMC123456&#39;).</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        path (Optional[str]): Local directory path to search for XML files.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">        dest (str): Destination directory for downloaded/extracted XML files.</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        (text_blocks, table_blocks) where text_blocks is a list of strings</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">               representing the main text sections, and table_blocks is a list of</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">               strings representing the tables extracted from the XML.</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="n">xml</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="n">dest</span> <span class="c1"># check for files downloaded from FTP or local XMLs</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="c1"># find the matching record in the filesystem</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[local] Searching </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> for full text XML for </span><span class="si">{</span><span class="n">pmcid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">xml</span> <span class="o">=</span> <span class="n">_find_local_fulltext</span><span class="p">(</span><span class="n">pmcid</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">xml</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="c1"># if not found locally, try the EuropePMC FTP</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ftp] Searching EuropePMC FTP for full text XML for </span><span class="si">{</span><span class="n">pmcid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">xml</span> <span class="o">=</span> <span class="n">_find_europepmc_ftp_fulltext</span><span class="p">(</span><span class="n">pmcid</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">xml</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="c1"># 1. Download the XML</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[api] Querying EuropePMC&#39;s API for full text XML for </span><span class="si">{</span><span class="n">pmcid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">epmc_base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pmcid</span><span class="si">}</span><span class="s2">/fullTextXML&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">xml</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">xml</span><span class="p">:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="c1"># 2. Parse with BeautifulSoup</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸŽ‰ XML found! Parsing text and tables from XML body&quot;</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s2">&quot;lxml-xml&quot;</span><span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="c1"># 3. Extract body text with headers</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="n">text_blocks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="c1"># 1. Title</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="n">title</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;article-title&quot;</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">title_text</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="k">if</span> <span class="n">title_text</span><span class="p">:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# TITLE</span><span class="se">\n</span><span class="si">{</span><span class="n">title_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="c1"># 2. Abstract</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="n">abstract</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;abstract&quot;</span><span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="k">if</span> <span class="n">abstract</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">abstract_title</span> <span class="o">=</span> <span class="n">abstract</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">if</span> <span class="n">abstract_title</span> <span class="ow">and</span> <span class="n">abstract_title</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ABSTRACT&#39;</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="n">abstract_title</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>  <span class="c1"># remove the title</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# ABSTRACT</span><span class="se">\n</span><span class="si">{</span><span class="n">_section_to_text</span><span class="p">(</span><span class="n">abstract</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="c1"># 2.1. Other metadata sections</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">funding_statement</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;funding-statement&quot;</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="k">if</span> <span class="n">funding_statement</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="n">funding_text</span> <span class="o">=</span> <span class="n">funding_statement</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">if</span> <span class="n">funding_text</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### FUNDING</span><span class="se">\n</span><span class="si">{</span><span class="n">funding_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="n">all_custom_metas</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;custom-meta&quot;</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="k">for</span> <span class="n">custom_meta</span> <span class="ow">in</span> <span class="n">all_custom_metas</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="n">meta_name</span> <span class="o">=</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;meta-name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="n">meta_value</span> <span class="o">=</span> <span class="n">custom_meta</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;meta-value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="k">if</span> <span class="n">meta_name</span> <span class="ow">and</span> <span class="n">meta_value</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">meta_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">meta_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="c1"># 3. Tables (captions + content)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="n">table_blocks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="k">for</span> <span class="n">tbl</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;table-wrap&quot;</span><span class="p">):</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="n">tbl</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="n">processed_table</span> <span class="o">=</span> <span class="n">_preprocess_xml_table</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="k">if</span> <span class="n">processed_table</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="n">table_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_table</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="c1"># 4. Main body (sections + paragraphs)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="c1"># excluded_section_types = [&quot;supplementary-material&quot;, &quot;orcid&quot;]</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="n">excluded_section_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;orcid&quot;</span><span class="p">]</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="n">body</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="k">if</span> <span class="n">body</span><span class="p">:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="n">all_sections</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;sec&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">all_sections</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sec-type&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">excluded_section_types</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="k">continue</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_section_to_text</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="n">text_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="k">return</span> <span class="n">text_blocks</span><span class="p">,</span> <span class="n">table_blocks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="gbcutils.europepmc.query_europepmc" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">query_europepmc</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">query_europepmc</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">endpoint</span><span class="p">,</span> <span class="n">request_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_exit</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Query Europe PMC REST API endpoint with retries.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>endpoint</code></b>
                  (<code><span title="str">str</span></code>)
              â€“
              <div class="doc-md-description">
                <p>The Europe PMC API endpoint to query.</p>
              </div>
            </li>
            <li>
              <b><code>request_params</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="dict">dict</span>]</code>, default:
                      <code>None</code>
)
              â€“
              <div class="doc-md-description">
                <p>Dictionary of query parameters.</p>
              </div>
            </li>
            <li>
              <b><code>no_exit</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              â€“
              <div class="doc-md-description">
                <p>If <code>True</code>, do not exit on error, return <code>None</code> instead.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Optional">Optional</span>[<span title="dict">dict</span>]</code>
              â€“
              <div class="doc-md-description">
                <p>The JSON response from Europe PMC, or <code>None</code> on error if <code>no_exit</code> is <code>True</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>gbcutils/europepmc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">def</span><span class="w"> </span><span class="nf">query_europepmc</span><span class="p">(</span><span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">request_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">no_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Query Europe PMC REST API endpoint with retries.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        endpoint (str): The Europe PMC API endpoint to query.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        request_params (Optional[dict]): Dictionary of query parameters.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        no_exit (bool): If `True`, do not exit on error, return `None` instead.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        The JSON response from Europe PMC, or `None` on error if `no_exit` is `True`.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">epmc_base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">request_params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;json&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="k">if</span> <span class="n">no_exit</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                    <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ Request failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Retrying (</span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Max retries exceeded.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../gbcutils_db/" class="btn btn-neutral float-left" title="db"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../gbcutils_metadata/" class="btn btn-neutral float-right" title="metadata">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/globalbiodata/gbc-publication-analysis" class="fa fa-code-fork" style="color: #fcfcfc"> gbc-publication-analysis</a>
        </span>
    
    
      <span><a href="../gbcutils_db/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../gbcutils_metadata/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
